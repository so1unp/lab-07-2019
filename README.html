<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.line-block{white-space: pre-line;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="laboratorio-7---administración-de-memoria">Laboratorio 7 - Administración de Memoria</h1>
<p>Consultar el apunte de práctica sobre administración de memoria en <em>xv6</em>, y el Capítulo 2 &quot;Page Tables&quot; del libro de <em>xv6</em>.</p>
<p>Las respuestas a los ejercicios deben realizarse en un documento en formato PDF, que se debe subir al repositorio.</p>
<h2 id="ejercicio-1-contador-de-páginas">Ejercicio 1: Contador de páginas</h2>
<p>Agregar a <em>xv6</em> una llamada al sistema <code>pgcnt</code>, que retorna la cantidad de páginas que ocupa el proceso actual. El código de la llamada al sistema lo pueden encontrar en el archivo <code>sys_pgcnt.c</code> (copiar su contenido en el archivo <code>sysproc.c</code>). Deben modificar el resto de los archivos requeridos para agregar la llamada al sistema.</p>
<p>El archivo <code>pgcnt.c</code> es un programa de usuario que invoca a la nueva llamada al sistema. Deben agregarlo a la lista <code>UPROGS</code> en el <code>Makefile</code> de <em>xv6</em>.</p>
<p>El programa <code>pgcnt.c</code> invoca <code>pgcnt</code> tres veces. La primera, al inicio del programa, y luego de invocar <code>sbrk</code> y <code>malloc</code>:</p>
<pre><code>$ pgcnt
2
3
11
$
</code></pre>
<h3 id="responder">Responder:</h3>
<ul>
<li>Explicar el resultado del programa, justificando el número de páginas que cada invocación a <code>pgcnt()</code> retorna. ¿Por qué la diferencia entre las invocaciones de <code>sbrk</code> y <code>malloc</code>?</li>
<li>Explicar línea por línea, cómo funciona la función <code>sys_pgcnt()</code>.</li>
</ul>
<h2 id="ejercicio-2-paginación-bajo-demanda">Ejercicio 2: Paginación bajo demanda</h2>
<p>Muchos programas reservan memoria que pueden no utilizar nunca, como por ejemplo, un arreglo de gran tamaño. El sistema operativo puede retrasar la asignación de memoria a estas secciones hasta que sean requeridos para su lectura/escritura. Cuando un proceso quiere acceder a estas secciones de memoria, ocurre un <em>page fault</em> (fallo de página), y el sistema operativo carga las páginas requeridas desde disco, o bien reserva la memoria requerida. En este ejercicio vamos a implementar un esquema de paginación bajo demanda rudimentario en <em>xv6</em>.</p>
<h3 id="parte-1">Parte 1</h3>
<p>Para incrementar el tamaño del segmento de datos, se utiliza la llamada al sistema <code>sbrk()</code>, que es implementada en la función <code>sys_sbrk()</code>, en el archivo <code>sysproc.c</code>.</p>
<p>Comentar la llamada a <code>growproc()</code>, que es la función que invoca a <code>sys_sbrk()</code>. Hecha esta modificación, compilar y ejecutar <em>xv6</em> y ejecutar el comando <code>echo hola</code>.</p>
<ul>
<li>¿Qué error aparece? ¿A qué tipo de error se refiere el número indicado por <code>trap</code>?</li>
</ul>
<h3 id="parte-2">Parte 2</h3>
<p>Modificar el código en el archivo <code>trap.c</code>, para que ante un <em>page fault</em>, producido por un programa a nivel de usuario, realice la carga de la página correspondiente a la dirección de memoria virtual que causó el <em>page fault</em>. No se necesitan cubrir todos los casos posibles de error, debe bastar para ejecutar comando simples como <code>echo</code> o <code>ls</code>.</p>
<p>El código a agregar en <code>trap.c</code> se puede encontrar en el archivo <code>pgflt.txt</code>. Como se invoca a <code>mappages()</code>, hay que eliminar la sentencia <code>static</code> de su declaración en el archivo <code>vm.c</code>, y agregar su prototipo en <code>trap.c</code>. Además, en la función <code>sys_sbrk()</code>, se debe actualizar el tamaño del proceso (<code>myproc()-&gt;sz</code>), en función del argumento <code>n</code>.</p>
<h3 id="responder-1">Responder:</h3>
<ul>
<li>¿Donde en particular, se debe agregar el código en <code>trap.c</code>?</li>
<li>Probar el correto funcionamiento de las modificaciones.</li>
<li>Explicar, línea por línea, el código del archivo <code>pgflt.txt</code>.</li>
</ul>
<hr />
<p>¡Fín del Laboratorio 7!</p>
</body>
</html>
